function Board(a,b,c){this.firstOpened=!1,this.boardActive=!0,this.timer=0,this.openBricks=0,this.width=a,this.height=b,this.mineAmt=c,this.minePos=[],this.numberHints=[],this.markers=[],this.boardState=[],this.init=function(){$(".minefield").css("width",20*a),$(".minefield").css("height",20*b),$(".wrapper").css("width",20*a+20);for(var c=0;c<this.height;c++)for(var d=0;d<this.width;d++)$(".minefield").append('<div class="brick brick-closed" data-brick="'+(d+this.width*c)+'"></div>'),this.markers[d+this.width*c]=0,this.boardState[d+this.width*c]=0;$(".btn-restart").html('<i class="fa fa-smile-o" aria-hidden="true"></i>'),this.boardActive=!0},this.shuffleMines=function(a){for(var b,a=parseInt(a),c=0;c<this.mineAmt;c++)b=Math.floor(Math.random()*(this.width*this.height)),jQuery.inArray(b,this.minePos)!=-1||b==a||b==a-1||b==a+1||b==a-this.width||b==a+this.width||b==a-this.width+1||b==a-this.width-1||b==a+this.width+1||b==a+this.width-1?c--:this.minePos.push(b);this.minePos.sort(function(a,b){return a-b})},this.showMines=function(){for(var a=0;a<this.minePos.length;a++)$(".brick[data-brick="+this.minePos[a]+"]").css("background-color","#fff")},this.generateNumbers=function(){for(var a=0;a<this.height*this.width;a++){var b=0;if(jQuery.inArray(a,this.minePos)==-1){var c=a%this.width==this.width-1,d=a%this.width==0,e=a-this.width<0,f=a+this.width>this.width*this.height;(c||!c&&!d)&&(jQuery.inArray(a-1,this.minePos)!=-1&&b++,(e||!e&&!f)&&(jQuery.inArray(a+this.width,this.minePos)!=-1&&b++,jQuery.inArray(a+this.width-1,this.minePos)!=-1&&b++),(f||!e&&!f)&&(jQuery.inArray(a-this.width,this.minePos)!=-1&&b++,jQuery.inArray(a-this.width-1,this.minePos)!=-1&&b++)),(d||!c&&!d)&&(jQuery.inArray(a+1,this.minePos)!=-1&&b++,(e||!e&&!f)&&(jQuery.inArray(a+this.width,this.minePos)!=-1&&d&&b++,jQuery.inArray(a+this.width+1,this.minePos)!=-1&&b++),(f||!e&&!f)&&(jQuery.inArray(a-this.width,this.minePos)!=-1&&d&&b++,jQuery.inArray(a-this.width+1,this.minePos)!=-1&&b++))}this.numberHints.push(b)}},this.setTimer=function(){if(time+=1,time<1e3){var a=time<10?"00"+time:time<100?"0"+time:time;$("#time").html(a)}},this.resetTimer=function(){window.clearInterval(this.timer),this.timer=0,$("#time").html("000"),time=0},this.setMineCounter=function(){for(var a=this.mineAmt,b=0;b<this.markers.length;b++)1==this.markers[b]&&a>0&&a--;var c=a<10?"00"+a:a<100?"0"+a:a;$("#mines").html(c)},this.placeMarker=function(a){switch(this.markers[a]=(this.markers[a]+1)%3,this.markers[a]){case 0:$(".brick[data-brick="+a+"]").html("");break;case 1:$(".brick[data-brick="+a+"]").html('<span class="flag"><i class="fa fa-flag" aria-hidden="true"></i></span>');break;case 2:$(".brick[data-brick="+a+"]").html('<span class="questionmark">?</span>')}this.setMineCounter()},this.firstOpening=function(a){this.firstOpened=!0,this.shuffleMines(a),this.generateNumbers(),this.timer=window.setInterval(timer,1e3)},this.killGame=function(a){for(var b=0;b<this.minePos.length;b++){var c=this.minePos[b];$(".brick[data-brick="+c+"]").removeClass("brick-closed").addClass("brick-open").css("background-color","").html('<span class="mine"><i class="fa fa-bomb" aria-hidden="true"></i></span>'),c==a&&$(".brick[data-brick="+c+"]").addClass("brick-boom")}window.clearInterval(this.timer),this.timer=0,$(".btn-restart").html('<i class="fa fa-frown-o" aria-hidden="true"></i>'),this.boardActive=!1,setTimeout(function(){alert("Boom. You ded.")},100)},this.didIWin=function(){this.openBricks==this.width*this.height-this.mineAmt&&(setTimeout(function(){alert("You are win")},100),window.clearInterval(this.timer),this.timer=0,this.boardActive=!1)},this.checkBrick=function(a){if(1!=this.boardState[a]&&!(a<0||a>this.width*this.height)){if($(".brick[data-brick="+a+"]").removeClass("brick-closed").addClass("brick-open"),this.openBricks++,this.boardState[a]=1,this.numberHints[a]>0)return void $(".brick[data-brick="+a+"]").html('<span class="number" data-number="'+this.numberHints[a]+'">'+this.numberHints[a]+"</span>");a=parseInt(a);var b=a%this.width==0,c=a%this.width==this.width-1;topEdge=a-this.width<0,bottomEdge=a+this.width>this.width*this.height,c||this.checkBrick(a+1),b||this.checkBrick(a-1),bottomEdge||this.checkBrick(a+this.width),c||this.checkBrick(a+this.width+1),b||this.checkBrick(a+this.width-1),topEdge||this.checkBrick(a-this.width),c||this.checkBrick(a-this.width+1),b||this.checkBrick(a-this.width-1)}},this.open=function(a,b,c,d){this.boardActive&&(this.firstOpened||this.firstOpening(a),jQuery.inArray(parseInt(a),this.minePos)!=-1&&0==b&&0==c?this.killGame(a):this.checkBrick(a),this.didIWin())}}